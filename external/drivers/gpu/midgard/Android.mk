LOCAL_PATH:= $(call my-dir)

include $(CLEAR_VARS)
LOCAL_MODULE_TAGS := optional
LOCAL_MODULE := mali_kbase.ko
LOCAL_MODULE_CLASS := SHARED_LIBRARIES
LOCAL_MODULE_RELATIVE_PATH := modules
LOCAL_SRC_FILES := mali/$(LOCAL_MODULE)
include $(BUILD_PREBUILT)

ifeq ($(TARGET_BUILD_VARIANT),user)
  DEBUGMODE := BUILD=no
else
  DEBUGMODE := $(DEBUGMODE)
endif
  #MALI_PLATFORM_NAME variable was added at file :device/sprd/*platform*/common/BoardCommon.mk 

$(LOCAL_PATH)/mali/mali_kbase.ko: $(TARGET_PREBUILT_KERNEL)
	$(MAKE) -C $(shell dirname $@) ARCH=$(TARGET_KERNEL_ARCH) CROSS_COMPILE=$(KERNEL_CROSS_COMPILE) CONFIG_MALI_PLATFORM_THIRDPARTY_NAME=$(MALI_PLATFORM_NAME) CONFIG_MALI_BOARD_PLATFORM=$(TARGET_BOARD_PLATFORM) $(DEBUGMODE) KDIR=$(ANDROID_PRODUCT_OUT)/obj/KERNEL clean
	$(MAKE) -C $(shell dirname $@) ARCH=$(TARGET_KERNEL_ARCH) CROSS_COMPILE=$(KERNEL_CROSS_COMPILE)$(EXT_FLAGS) CONFIG_MALI_PLATFORM_THIRDPARTY_NAME=$(MALI_PLATFORM_NAME) CONFIG_MALI_BOARD_PLATFORM=$(TARGET_BOARD_PLATFORM) $(DEBUGMODE) KDIR=$(ANDROID_PRODUCT_OUT)/obj/KERNEL
	@-$(KERNEL_CROSS_COMPILE)strip -d --strip-unneeded $@
